<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tarifario | Chapelco Seguridad Integral</title>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: #1a1a1a;
    color: #f2f2f2;
}

.container {
    max-width: 1100px;
    margin: auto;
    padding: 20px;
}

/* ===== LOGO CORREGIDO ===== */
.header {
    position: fixed;
    top: 3px;
    right: 20px;
    z-index: 1000;
}

.header img {
    width: 180px;
    height: auto;
    display: block;
}

/* ========================= */

.subtitle {
    color: #aaa;
    font-size: 14px;
    margin-top: 60px; /* separa del logo */
}

.card {
    background: #242424;
    border-radius: 14px;
    padding: 25px;
}


.filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
    gap: 15px;
}

label {
    font-size: 13px;
    color: #ccc;
}

select, button {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-size: 15px;
}

select {
    background: #222;
    color: #fff;
}

button {
    background: #ff7a18;
    font-weight: bold;
    cursor: pointer;
}

button.secondary {
    background: #444;
    color: #fff;
}

.actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.table-wrapper {
    overflow-x: auto;
    margin-top: 25px;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    padding: 12px;
    border-bottom: 1px solid #333;
}

th {
    text-align: left;
    color: #bbb;
}
</style>
</head>

<body>

<!-- LOGO -->
<div class="header">
    <img src="logo.png" alt="Logo de Chapelco Seguridad">
</div>

<div class="container">

    <div class="subtitle">Tarifario de Servicios</div>

    <div class="card">

        <div class="filters">
            <div>
                <label>Cliente</label>
                <select id="cliente"></select>
            </div>

            <div>
                <label>Año</label>
                <select id="anio"></select>
            </div>

            <div>
                <label>Mes</label>
                <select id="mes"></select>
            </div>
        </div>

        <div class="actions">
            <button onclick="buscar()">Buscar tarifas</button>
            <button class="secondary" onclick="limpiar()">Limpiar</button>
            <button class="secondary" onclick="exportarPDF()">Exportar PDF</button>
        </div>

        <div class="table-wrapper">
            <table id="tabla" style="display:none">
                <thead>
                    <tr>
                        <th>Servicio</th>
                        <th>Tarifa</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyYmNndzhboToYVJmIx0M3V8027X4eDHRAfXMtDWLwpo8eoZA2BgFzht1-X7Rxes0k5Rg/exec";

const clienteEl = () => document.getElementById("cliente");
const anioEl = () => document.getElementById("anio");
const mesEl = () => document.getElementById("mes");

async function cargarFiltros() {
    const res = await fetch(API + "?action=distinct");
    const d = await res.json();

    fill(clienteEl(), d.clientes);
    fill(anioEl(), d.años);
    fill(mesEl(), d.meses);
}

function fill(select, arr) {
    select.innerHTML = `<option value="">Seleccionar</option>`;
    arr.forEach(v => select.innerHTML += `<option>${v}</option>`);
}

async function buscar() {
    if (!clienteEl().value || !anioEl().value || !mesEl().value) {
        alert("Seleccioná cliente, año y mes");
        return;
    }

    const url = `${API}?action=search&cliente=${clienteEl().value}&año=${anioEl().value}&mes=${mesEl().value}`;
    const res = await fetch(url);
    const data = await res.json();

    const tbody = document.querySelector("#tabla tbody");
    tbody.innerHTML = "";

    data.results.forEach(r => {
        tbody.innerHTML += `
            <tr>
                <td>${r.servicio}</td>
                <td>$ ${Number(r.tarifa).toLocaleString("es-AR")}</td>
            </tr>
        `;
    });

    document.getElementById("tabla").style.display = "table";
}

function limpiar() {
    clienteEl().value = "";
    anioEl().value = "";
    mesEl().value = "";
    document.getElementById("tabla").style.display = "none";
}

function exportarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF("p", "mm", "a4");

    // TITULO
    doc.setFont("helvetica", "bold");
    doc.setFontSize(20);
    doc.setTextColor(255, 122, 24);
    doc.text("CHAPELCO SEGURIDAD INTEGRAL", 105, 20, { align: "center" });

    // SUBTITULO
    doc.setFontSize(13);
    doc.setTextColor(60);
    doc.text("Tarifario de Servicios", 105, 30, { align: "center" });

    // LINEA FUERTE (VISIBLE)
    doc.setDrawColor(255, 122, 24);
    doc.setLineWidth(1);
    doc.line(20, 35, 190, 35);

    // RECUADRO CLIENTE
    doc.setFillColor(240, 240, 240);
    doc.setDrawColor(180);
    doc.rect(14, 42, 182, 16, "FD");

    doc.setFontSize(11);
    doc.setTextColor(0);
    doc.text(`Cliente: ${clienteEl().value}`, 18, 52);
    doc.text(`Periodo: ${mesEl().value} ${anioEl().value}`, 140, 52);

    // TABLA
    let y = 75;

    doc.setFont("helvetica", "bold");
    doc.text("Servicio", 18, y);
    doc.text("Tarifa", 165, y);

    // línea encabezado
    doc.setLineWidth(0.6);
    doc.setDrawColor(0);
    doc.line(18, y + 2, 190, y + 2);

    y += 8;
    doc.setFont("helvetica", "normal");

    document.querySelectorAll("#tabla tbody tr").forEach(row => {
        const cols = row.querySelectorAll("td");

        doc.text(cols[0].innerText, 18, y);
        doc.text(cols[1].innerText, 165, y);

        // línea entre filas
        doc.setDrawColor(200);
        doc.setLineWidth(0.3);
        doc.line(18, y + 2, 190, y + 2);

        y += 7;
    });

    doc.save(`Tarifario_${clienteEl().value}_${Date.now()}.pdf`);
}



cargarFiltros();
</script>

</body>
</html>


